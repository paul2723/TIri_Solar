<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TiriSolar ‚Äî Landing con Chatbot</title>
  <style>
    :root{
      --bg: #ecfdf5;
      --bg-soft:#f9fafb;
      --brand: #059669;
      --brand-dark:#047857;
      --ink:#0f172a;
      --muted:#6b7280;
      --card:#ffffff;
      --border:#e5e7eb;
      --shadow:0 18px 45px rgba(15,118,110,.18);
      --radius-lg:24px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      color:var(--ink);
      background:radial-gradient(circle at top,#a7f3d0 0,#ecfdf5 30%,#f9fafb 70%);
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1120px;margin:0 auto;padding:0 24px}
    header{
      position:sticky;top:0;
      background:rgba(248,250,252,.9);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(148,163,184,.25);
      z-index:40;
    }
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;gap:10px;align-items:center}
    .brand-badge{
      width:40px;height:40px;border-radius:16px;
      background:radial-gradient(circle at 25% 10%,#bbf7d0 0,#059669 40%,#022c22 100%);
      color:#ecfdf5;display:grid;place-items:center;
      font-weight:800;font-size:18px;box-shadow:0 8px 18px rgba(4,120,87,.4);
    }
    .brand strong{font-size:18px;}
    nav a{font-size:14px;color:var(--muted);margin-left:18px}
    nav a:hover{color:var(--brand-dark)}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      border-radius:999px;padding:10px 18px;font-size:14px;font-weight:500;
      border:none;cursor:pointer;transition:.18s ease all;
    }
    .btn-primary{background:var(--brand);color:#fff;box-shadow:0 10px 25px rgba(4,120,87,.35)}
    .btn-primary:hover{background:var(--brand-dark);transform:translateY(-1px)}
    .btn-ghost{
      background:transparent;color:#047857;
      border:1px solid #bbf7d0;
    }
    .btn-ghost:hover{background:#ecfdf5}
    .hero{padding:56px 0 40px}
    .grid{display:grid;gap:28px}
    @media(min-width:900px){.grid-2{grid-template-columns:1.05fr .95fr}}
    h1{margin:0;font-size:40px;line-height:1.12}
    @media(min-width:900px){h1{font-size:46px}}
    .muted{color:var(--muted)}
    .hero-card{
      border-radius:var(--radius-lg);
      background:radial-gradient(circle at top left,#d1fae5 0,#ecfdf5 45%,#e5e7eb 100%);
      box-shadow:var(--shadow);
      position:relative;overflow:hidden;
      padding:20px 22px 16px;
      border:1px solid rgba(148,163,184,.3);
    }
    .hero-card-header{
      display:flex;justify-content:space-between;align-items:flex-start;
      gap:12px;margin-bottom:14px;
    }
    .hero-kpi-label{font-size:13px;color:var(--muted);letter-spacing:.02em;text-transform:uppercase}
    .hero-kpi-value{font-size:34px;font-weight:800;color:#047857}
    .hero-kpi-sub{font-size:13px;color:var(--muted);}
    .hero-chip{
      padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(148,163,184,.4);
      font-size:11px;color:#0f766e;display:inline-flex;align-items:center;gap:6px;
    }
    .hero-chip-dot{
      width:8px;height:8px;border-radius:999px;background:#22c55e;
      box-shadow:0 0 0 4px rgba(34,197,94,.25);
    }
    .hero-chart-wrap{
      margin-top:10px;
      border-radius:18px;
      background:linear-gradient(135deg,rgba(236,253,245,.9),rgba(209,250,229,.7));
      box-shadow:inset 0 0 30px rgba(15,118,110,.08);
      overflow:hidden;
    }
    section{padding:40px 0}
    .section-title{font-size:22px;margin:0 0 4px}
    .section-sub{margin:0 0 20px;color:var(--muted);font-size:14px}
    .cards{display:grid;gap:18px}
    @media(min-width:900px){.cards-3{grid-template-columns:repeat(3,1fr)}}
    .card{
      background:var(--card);
      border-radius:20px;
      border:1px solid var(--border);
      box-shadow:0 10px 30px rgba(15,23,42,.06);
      overflow:hidden;
    }
    .card .body{padding:20px 22px}
    .tag-pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 10px;border-radius:999px;
      background:#ecfdf5;border:1px solid #a7f3d0;
      font-size:11px;color:#047857;text-transform:uppercase;
      letter-spacing:.08em;
    }
    .price{font-size:28px;font-weight:700}
    .card-footer{padding:16px 22px 20px;border-top:1px dashed var(--border)}
    ul.bullets{margin:0 0 12px 18px;font-size:14px;color:#374151;line-height:1.6}
    footer{border-top:1px solid rgba(148,163,184,.35);background:#f9fafb}
    footer .row{display:flex;justify-content:space-between;align-items:center;padding:18px 0;flex-wrap:wrap;gap:10px}
    footer a{font-size:13px;color:var(--muted)}
    footer a:hover{color:var(--brand-dark)}
    .sim-btn{
      position:absolute;top:12px;right:14px;
      background:rgba(255,255,255,.95);
      border:1px solid #a7f3d0;border-radius:999px;
      padding:6px 12px;font-size:11px;color:#047857;cursor:pointer;
    }

    /* SIMULADOR */
    .simulator-card{
      background:var(--card);
      border-radius:var(--radius-lg);
      border:1px solid var(--border);
      box-shadow:0 14px 40px rgba(15,23,42,.08);
      padding:22px 22px 18px;
      display:grid;gap:18px;
    }
    @media(min-width:900px){
      .simulator-card{grid-template-columns:1.1fr .9fr;align-items:stretch}
    }
    .sim-grid{display:grid;gap:10px}
    .field label{font-size:13px;color:var(--muted);display:block;margin-bottom:3px}
    .field input,.field select{
      width:100%;padding:9px 11px;border-radius:12px;
      border:1px solid #d1d5db;font-size:14px;
    }
    .sim-result-label{font-size:13px;color:var(--muted);text-transform:uppercase;letter-spacing:.12em}
    .sim-result-main{font-size:32px;font-weight:800;color:#047857}
    .sim-result-sub{font-size:13px;color:var(--muted);}
    .sim-result-kpi{
      margin-top:12px;
      padding:10px 12px;border-radius:16px;
      background:linear-gradient(120deg,#ecfdf5,#e5f3ff);
      font-size:12px;color:#0369a1;
    }

    /* MODAL COTIZACI√ìN */
    #quote-backdrop{
      position:fixed;inset:0;background:rgba(15,23,42,.45);
      display:none;align-items:center;justify-content:center;
      z-index:60;
    }
    #quote-modal{
      background:#ffffff;border-radius:24px;
      max-width:440px;width:100%;box-shadow:0 22px 60px rgba(15,23,42,.55);
      overflow:hidden;
    }
    #quote-modal-header{
      padding:16px 20px;border-bottom:1px solid #e5e7eb;
      display:flex;justify-content:space-between;align-items:center;
    }
    #quote-modal-header h3{margin:0;font-size:18px}
    #quote-modal-header small{display:block;color:var(--muted);font-size:12px}
    #quote-modal-close{
      background:transparent;border:none;font-size:22px;cursor:pointer;color:#6b7280;
    }
    #quote-modal-body{padding:18px 20px 12px}
    #quote-modal-body .field{margin-bottom:10px}
    #quote-plan-label{font-size:13px;color:#047857;font-weight:600}
    #quote-modal-footer{
      padding:14px 20px 18px;border-top:1px solid #e5e7eb;
      display:flex;justify-content:flex-end;gap:10px;
    }

    /* Lista de cotizaciones guardadas */
    #leads-card{
      background:#f9fafb;
      border-radius:20px;
      border:1px dashed #d1d5db;
      padding:18px 20px;
      box-shadow:0 8px 20px rgba(15,23,42,.04);
      font-size:14px;
    }
    #quote-list{
      margin:10px 0 0;
      padding-left:18px;
      color:#374151;
    }
    #quote-list li span{
      font-weight:600;
      color:#047857;
    }
    #quote-list li small{
      color:#64748b;
      font-size:11px;
    }

    /* Chatbot */
    #chat-launch{
      position:fixed;right:20px;bottom:22px;
      width:56px;height:56px;border-radius:999px;
      background:var(--brand);color:#fff;border:none;
      display:grid;place-items:center;box-shadow:0 18px 40px rgba(4,120,87,.65);
      cursor:pointer;z-index:50;
    }
    #chat-panel{
      position:fixed;right:20px;bottom:90px;
      width:360px;max-width:calc(100vw - 40px);max-height:72vh;
      background:rgba(255,255,255,.98);backdrop-filter:blur(10px);
      border:1px solid #a7f3d0;border-radius:20px;
      box-shadow:0 20px 60px rgba(4,120,87,.4);
      display:none;flex-direction:column;overflow:hidden;z-index:50;
    }
    #chat-head{
      display:flex;align-items:center;justify-content:space-between;
      background:linear-gradient(120deg,#059669,#22c55e);
      color:#ecfdf5;padding:10px 14px;
    }
    #chat-quick{display:flex;gap:8px;flex-wrap:wrap;padding:8px 10px;border-bottom:1px solid #d1fae5}
    #chat-quick button{
      font-size:12px;padding:6px 10px;border-radius:999px;
      border:1px solid #a7f3d0;background:#f9fafb;color:#065f46;cursor:pointer;
    }
    #chat-log{padding:10px 12px 58px;overflow:auto;flex:1;background:#f8fafc}
    .msg{display:flex;gap:8px;margin-bottom:8px}
    .msg .bubble{padding:8px 10px;border-radius:14px;max-width:77%;font-size:13px}
    .bot .bubble{background:#ecfdf5;color:#064e3b}
    .user{justify-content:flex-end}
    .user .bubble{background:var(--brand);color:#fff}
    #chat-input{
      position:absolute;left:0;right:0;bottom:0;
      padding:8px;background:#fff;border-top:1px solid #e2e8f0;
      display:flex;gap:8px;
    }
    #chat-input input{
      flex:1;padding:10px 12px;border:1px solid #cbd5e1;border-radius:999px;font-size:13px;
    }
    #chat-input button{
      padding:9px 13px;border:none;border-radius:999px;background:var(--brand);color:#fff;cursor:pointer;font-size:13px;
    }
    #chat-close{background:transparent;border:none;color:#ecfdf5;font-size:20px;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="brand-badge">Ti</div>
        <strong>TiriSolar</strong>
      </div>
      <nav class="hide-sm">
        <a href="#simulador">Simulador</a>
        <a href="#planes">Planes</a>
        <a href="#beneficios">Beneficios</a>
        <a href="#faq">FAQ</a>
      </nav>
      <button class="btn btn-primary" id="cta-header">Cotizar ahora</button>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="container grid grid-2">
        <div>
          <h1>Energ√≠a solar para tu casa, sin complicarte la vida.</h1>
          <p class="muted" style="margin-top:10px;font-size:17px">
            Empieza desde <strong>$1,000 (USD)</strong>. Instalaci√≥n profesional, monitoreo
            y acompa√±amiento por 5 a√±os.
          </p>
          <div style="margin-top:18px;display:flex;gap:12px;flex-wrap:wrap">
            <a class="btn btn-primary" href="#simulador">Probar simulador</a>
            <a class="btn btn-ghost" href="#planes">Ver planes</a>
          </div>
          <div class="muted" style="margin-top:12px;font-size:12px">
            Moneda: USD ¬∑ Soporte 5 a√±os ¬∑ Demo acad√©mica
          </div>
        </div>

        <!-- TARJETA CON GR√ÅFICO -->
        <div>
          <div class="hero-card">
            <div class="hero-card-header">
              <div>
                <div class="hero-kpi-label">Ahorro estimado mensual</div>
                <div id="hero-kpi-value" class="hero-kpi-value">$48</div>
                <div id="hero-kpi-sub" class="hero-kpi-sub">
                  Basado en factura de <strong>$80</strong> y <strong>40%</strong> de ahorro estimado.
                </div>
              </div>
              <div style="text-align:right">
                <div class="hero-chip">
                  <span class="hero-chip-dot"></span> Sistema funcionando estable
                </div>
                <button class="sim-btn" id="sim-rerun" type="button">Re-simular curva solar</button>
              </div>
            </div>
            <small class="muted">
              El gr√°fico muestra tu generaci√≥n solar estimada frente a las horas del d√≠a.
            </small>
            <div class="hero-chart-wrap" style="margin-top:10px">
              <svg id="sim-chart" viewBox="0 0 800 300" preserveAspectRatio="none" width="100%" height="100%">
                <defs>
                  <linearGradient id="simFill" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="#059669" stop-opacity="0.35" />
                    <stop offset="100%" stop-color="#059669" stop-opacity="0.02" />
                  </linearGradient>
                </defs>
                <rect x="0" y="0" width="800" height="300" fill="transparent" />
                <line x1="60" y1="20" x2="60" y2="260" stroke="#94a3b8" stroke-width="1" />
                <line x1="60" y1="260" x2="784" y2="260" stroke="#94a3b8" stroke-width="1" />
                <g id="sim-yticks"></g>
                <g id="sim-xticks"></g>
                <path id="sim-area" fill="url(#simFill)"></path>
                <path id="sim-line" fill="none" stroke="#065f46" stroke-width="3" stroke-linejoin="round" stroke-linecap="round"></path>
                <text x="20" y="32" fill="#065f46" font-size="11" transform="rotate(-90,20,32)">Potencia (kW)</text>
                <text x="720" y="290" fill="#334155" font-size="11">Hora del d√≠a</text>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- BENEFICIOS -->
    <section id="beneficios">
      <div class="container">
        <h2 class="section-title">¬øPor qu√© TiriSolar?</h2>
        <p class="section-sub">Dise√±ado para personas que quieren ahorrar y estar tranquilas.</p>
        <div class="cards cards-3">
          <div class="card"><div class="body">
            <span class="tag-pill">Ahorro</span>
            <h3 style="margin:10px 0 4px">Menos en tu factura</h3>
            <p class="muted" style="margin:0;font-size:14px">
              Reduce tu pago de luz desde el primer mes y visualiza el ahorro en la app.
            </p>
          </div></div>
          <div class="card"><div class="body">
            <span class="tag-pill">Calidad</span>
            <h3 style="margin:10px 0 4px">Todo instalado por expertos</h3>
            <p class="muted" style="margin:0;font-size:14px">
              Equipos certificados, dise√±o adaptado al clima de Guayaquil y montaje profesional.
            </p>
          </div></div>
          <div class="card"><div class="body">
            <span class="tag-pill">Soporte</span>
            <h3 style="margin:10px 0 4px">No te dejamos solo</h3>
            <p class="muted" style="margin:0;font-size:14px">
              Soporte y mantenimiento preventivo por 5 a√±os, con recordatorios y chat de ayuda.
            </p>
          </div></div>
        </div>
      </div>
    </section>

    <!-- SIMULADOR -->
    <section id="simulador">
      <div class="container">
        <h2 class="section-title">Simulador r√°pido de ahorro</h2>
        <p class="section-sub">
          Ingresa tu factura promedio de luz residencial. Nosotros estimamos un
          <strong> porcentaje t√≠pico de ahorro</strong> seg√∫n tu consumo para mostrarte un valor
          aproximado (solo para fines de validaci√≥n del prototipo).
        </p>

        <div class="simulator-card">
          <!-- Izquierda: formulario -->
          <div class="sim-grid">
            <div class="field">
              <label for="bill-input">Factura mensual de luz (USD)</label>
              <input id="bill-input" type="number" min="0" step="1" value="80" />
            </div>
            <div class="field">
              <label for="profile-select">Tipo de cliente</label>
              <select id="profile-select" disabled>
                <option value="residencial">Residencial</option>
              </select>
            </div>
            <div>
              <button id="sim-calc" class="btn btn-primary" type="button">Calcular ahorro</button>
            </div>
          </div>

          <!-- Derecha: resultados -->
          <div>
            <div class="sim-result-label">Ahorro estimado mensual</div>
            <div id="sim-ahorro" class="sim-result-main">$48</div>
            <div id="sim-ahorro-sub" class="sim-result-sub">
              Basado en una factura de <strong>$80</strong> y un ahorro estimado del <strong>40%</strong>.
            </div>
            <div id="sim-extra" class="sim-result-kpi">
              En un a√±o ahorrar√≠as aproximadamente <strong>$576</strong>. Con un sistema modular puedes
              empezar peque√±o y ampliarlo despu√©s si tu consumo crece.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PLANES -->
    <section id="planes">
      <div class="container">
        <h2 class="section-title">Planes</h2>
        <p class="section-sub">Precios en USD. Todos incluyen instalaci√≥n est√°ndar y soporte por 5 a√±os.</p>
        <div class="cards cards-3">
          <!-- Starter -->
          <div class="card">
            <div class="body">
              <span class="tag-pill">Residencial para 1 persona</span>
              <h3 style="margin:10px 0 4px">Starter 1.5 kW</h3>
              <p class="muted" style="margin:0 0 8px;font-size:13px">Ideal para departamentos o casas peque√±as.</p>
              <div class="price">$1,000 <span class="muted" style="font-size:14px;font-weight:400">desde</span></div>
            </div>
            <div class="card-footer">
              <ul class="bullets">
                <li>Hasta 4 paneles</li>
                <li>Monitoreo b√°sico</li>
                <li>Soporte 5 a√±os</li>
                <li>Instalaci√≥n est√°ndar</li>
              </ul>
              <button class="btn btn-primary quote-btn" data-plan="Starter 1.5 kW">Solicitar cotizaci√≥n</button>
            </div>
          </div>

          <!-- Pro -->
          <div class="card" style="position:relative;transform:translateY(-6px)">
            <div style="position:absolute;top:10px;right:16px;font-size:11px;background:#e0f2fe;color:#0369a1;padding:3px 8px;border-radius:999px;">M√°s elegido</div>
            <div class="body">
              <span class="tag-pill">Hogar familiar residencial</span>
              <h3 style="margin:10px 0 4px">Pro 3‚Äì5 kW</h3>
              <p class="muted" style="margin:0 0 8px;font-size:13px">Para familias con aire acondicionado y varios equipos.</p>
              <div class="price">$3,500 <span class="muted" style="font-size:14px;font-weight:400">desde</span></div>
            </div>
            <div class="card-footer">
              <ul class="bullets">
                <li>6‚Äì12 paneles</li>
                <li>App de monitoreo en tiempo real</li>
                <li>Optimizaci√≥n de consumo</li>
                <li>Soporte y mantenimiento preventivo</li>
              </ul>
              <button class="btn btn-primary quote-btn" data-plan="Pro 3‚Äì5 kW">Solicitar cotizaci√≥n</button>
            </div>
          </div>

          <!-- Business -->
          <div class="card">
            <div class="body">
              <span class="tag-pill">Negocio residencial</span>
              <h3 style="margin:10px 0 4px">Business 10+ kW</h3>
              <p class="muted" style="margin:0 0 8px;font-size:13px">Comercial e industrial ligero con alta demanda.</p>
              <div class="price">$12,000 <span class="muted" style="font-size:14px;font-weight:400">desde</span></div>
            </div>
            <div class="card-footer">
              <ul class="bullets">
                <li>Dise√±o a medida</li>
                <li>Telemetr√≠a avanzada</li>
                <li>Prioridad de soporte</li>
                <li>Soporte 5 a√±os</li>
              </ul>
              <button class="btn btn-primary quote-btn" data-plan="Business 10+ kW">Solicitar cotizaci√≥n</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq">
      <div class="container">
        <h2 class="section-title">Preguntas frecuentes</h2>
        <p class="section-sub">Lo b√°sico antes de tomar una decisi√≥n.</p>
        <div class="cards">
          <div class="card"><div class="body">
            <h3 style="margin:0 0 4px">¬øQu√© incluye el plan?</h3>
            <p class="muted" style="margin:0;font-size:14px">
              Dise√±o, instalaci√≥n est√°ndar, configuraci√≥n de inversor/monitor, puesta en marcha y soporte por 5 a√±os.
            </p>
          </div></div>
          <div class="card"><div class="body">
            <h3 style="margin:0 0 4px">¬øCu√°nto tarda la instalaci√≥n?</h3>
            <p class="muted" style="margin:0;font-size:14px">
              Desde aprobaci√≥n y visita t√©cnica: 3‚Äì7 d√≠as h√°biles. Instalaci√≥n t√≠pica: 1‚Äì2 d√≠as para residencias.
            </p>
          </div></div>
          <div class="card"><div class="body">
            <h3 style="margin:0 0 4px">¬øPuedo empezar peque√±o?</h3>
            <p class="muted" style="margin:0;font-size:14px">
              S√≠, el sistema es modular: puedes iniciar con pocos paneles y ampliarlos m√°s adelante seg√∫n tu presupuesto.
            </p>
          </div></div>
          <div class="card"><div class="body">
            <h3 style="margin:0 0 4px">¬øNecesito bater√≠as?</h3>
            <p class="muted" style="margin:0;font-size:14px">
              Son opcionales. Esta demo no incluye almacenamiento; podemos cotizarlo por separado si lo necesitas.
            </p>
          </div></div>
        </div>
      </div>
    </section>

    <!-- REGISTROS DE COTIZACI√ìN (solo para /localStorage) -->
    <section>
      <div class="container">
        <h2 class="section-title">Registros de cotizaci√≥n </h2>
        <p class="section-sub">
          Estos datos se guardan <strong>solo en tu navegador</strong> usando localStorage. Sirven como evidencia
          de que el usuario dej√≥ sus datos en la landing.
        </p>
        <div id="leads-card">
          <strong style="font-size:14px">Personas que han solicitado cotizaci√≥n:</strong>
          <ul id="quote-list">
            <!-- Se llena con JS -->
          </ul>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container row">
      <div>¬© <span id="year"></span> TiriSolar ‚Ä¢  frontend</div>
      <div style="display:flex;gap:16px">
        <a href="#planes">Planes</a>
        <a href="#faq">FAQ</a>
        <a href="#simulador">Simulador</a>
      </div>
    </div>
  </footer>

  <!-- MODAL DE COTIZACI√ìN -->
  <div id="quote-backdrop">
    <div id="quote-modal">
      <div id="quote-modal-header">
        <div>
          <h3>Solicitar cotizaci√≥n</h3>
          <small id="quote-plan-label">Plan seleccionado</small>
        </div>
        <button id="quote-modal-close" aria-label="Cerrar">√ó</button>
      </div>
      <div id="quote-modal-body">
        <div class="field">
          <label for="q-name">Nombre completo</label>
          <input id="q-name" type="text" placeholder="Ej. Ana Torres" />
        </div>
        <div class="field">
          <label for="q-phone">Tel√©fono / WhatsApp</label>
          <input id="q-phone" type="tel" placeholder="Ej. 09xxxxxxxx" />
        </div>
        <div class="field">
          <label for="q-email">Correo electr√≥nico</label>
          <input id="q-email" type="email" placeholder="Ej. ana@mail.com" />
        </div>
        <div class="field">
          <label for="q-city">Ciudad</label>
          <input id="q-city" type="text" placeholder="Guayaquil" />
        </div>
        <div class="field">
          <label for="q-bill">Factura aproximada de luz (USD)</label>
          <input id="q-bill" type="number" min="0" step="1" placeholder="Ej. 80" />
        </div>
        <p class="muted" style="font-size:11px;margin-top:4px">
                  </p>
      </div>
      <div id="quote-modal-footer">
        <button class="btn btn-ghost" type="button" id="quote-cancel">Cancelar</button>
        <button class="btn btn-primary" type="button" id="quote-send">Enviar solicitud</button>
      </div>
    </div>
  </div>

  <!-- CHATBOT -->
  <button id="chat-launch" aria-label="Abrir chat" title="Chatear">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
      <path d="M7 8h10v2H7V8zm0 4h7v2H7v-2zm5 8a1 1 0 0 1-.707-.293L8.586 17H5a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3h-6l-3.293 3.293A1 1 0 0 1 12 20z"/>
    </svg>
  </button>

  <div id="chat-panel">
    <div id="chat-head">
      <strong>TiriBot</strong>
      <button id="chat-close" title="Cerrar">√ó</button>
    </div>
    <div id="chat-quick"></div>
    <div id="chat-log"></div>
    <div id="chat-input">
      <input id="chat-text" placeholder="Escribe aqu√≠..." />
      <button id="chat-send">Enviar</button>
    </div>
  </div>

  <script>
    // A√±o footer
    document.getElementById('year').textContent = new Date().getFullYear();

    // ====== localStorage para cotizaciones ======
    const STORAGE_KEY = 'tiri_leads';
    const quoteListEl = document.getElementById('quote-list');

    function loadLeads(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      }catch(e){
        return [];
      }
    }
    let leads = loadLeads();

    function renderLeads(){
      if(!quoteListEl) return;
      if(!leads.length){
        quoteListEl.innerHTML = '<li class="muted">Todav√≠a no hay registros en este navegador.</li>';
        return;
      }
      quoteListEl.innerHTML = leads.map(l => {
        const fecha = new Date(l.date).toLocaleString('es-EC',{dateStyle:'short',timeStyle:'short'});
        return `<li><span>${l.name}</span> ‚Äî ${l.plan} <br><small>${fecha} ¬∑ Tel: ${l.phone || '‚Äî'}</small></li>`;
      }).join('');
    }
    renderLeads();

    // ========== CHATBOT ==========
    const launch = document.getElementById('chat-launch');
    const panel  = document.getElementById('chat-panel');
    const closeB = document.getElementById('chat-close');
    const log    = document.getElementById('chat-log');
    const input  = document.getElementById('chat-text');
    const send   = document.getElementById('chat-send');
    const quick  = document.getElementById('chat-quick');

    const quickBtns = [
      { label: 'Cotizar', payload: 'cotizar' },
      { label: '¬øQu√© incluye?', payload: 'incluye' },
      { label: 'Plazos', payload: 'plazos' },
      { label: 'Contacto', payload: 'contacto' }
    ];

    function addMsg(role, text){
      const row = document.createElement('div');
      row.className = 'msg ' + (role === 'bot' ? 'bot' : 'user');
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;
      row.appendChild(bubble);
      log.appendChild(row);
      log.scrollTop = log.scrollHeight;
    }

    function reply(userText){
      const lower = userText.toLowerCase();
      const responses = [];
      if(/(cotiza|coti|precio|plan)/.test(lower)){
        responses.push('Perfecto. Para estimar: 1) tu consumo mensual en kWh, 2) tipo de techo, 3) ciudad. Nuestros planes residenciales inician en $1,000 (USD).');
      }
      if(/(incluye|qu√© incluye|incluye\?|que incluye)/.test(lower)){
        responses.push('Todos los planes incluyen dise√±o, instalaci√≥n est√°ndar, configuraci√≥n del inversor/monitor, puesta en marcha y soporte por 5 a√±os.');
      }
      if(/(plazo|tiempo|instala)/.test(lower)){
        responses.push('Tiempos t√≠picos: 3‚Äì7 d√≠as h√°biles desde la aprobaci√≥n y visita t√©cnica. La instalaci√≥n suele tomar 1‚Äì2 d√≠as.');
      }
      if(/(contacto|whatsapp|email|correo|tel)/.test(lower)){
        responses.push('Puedes dejar tus datos en el bot√≥n ‚ÄúSolicitar cotizaci√≥n‚Äù  simplemente escribir nombre y tel√©fono para simular el registro.');
      }
      if(responses.length===0){
        responses.push('Puedo ayudarte a cotizar o explicar los planes. Prueba con: ‚Äúcotizar‚Äù, ‚Äúqu√© incluye‚Äù, ‚Äúplazos‚Äù o ‚Äúcontacto‚Äù.');
      }
      addMsg('user', userText);
      responses.forEach(t=>addMsg('bot', t));
    }

    // Quick buttons y mensaje inicial
    quickBtns.forEach(q=>{
      const b=document.createElement('button');
      b.textContent=q.label; b.onclick=()=>reply(q.payload);
      quick.appendChild(b);
    });
    addMsg('bot','Hola, soy TiriBot ü§ñ. ¬øTe ayudo a cotizar, conocer planes o tiempos de instalaci√≥n?');

    launch.onclick=()=>{ 
      panel.style.display = panel.style.display==='flex' ? 'none' : 'flex';
      if(panel.style.display==='flex'){ input.focus(); }
    };
    closeB.onclick=()=>{ panel.style.display='none'; };
    send.onclick=()=>{ const t=input.value.trim(); if(t){ input.value=''; reply(t);} };
    input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ const t=input.value.trim(); if(t){ input.value=''; reply(t);} } });

    // ========== GR√ÅFICO SIMULADO ==========
    (function(){
      const svg = document.getElementById('sim-chart');
      if(!svg) return;
      const W = 800, H = 300;
      const margin = {left:60,right:16,top:20,bottom:32};
      const cw = W - margin.left - margin.right;
      const ch = H - margin.top - margin.bottom;
      const maxKW = 5;

      function pathFrom(data){
        const stepX = cw / (data.length - 1);
        return data.map((y,i)=>{
          const x = margin.left + i*stepX;
          const yv = margin.top + ch - (Math.min(y,maxKW)/maxKW)*ch;
          return (i===0?`M ${x} ${yv}`:`L ${x} ${yv}`);
        }).join(' ');
      }
      function render(data){
        const line = svg.querySelector('#sim-line');
        const area = svg.querySelector('#sim-area');
        const d = pathFrom(data);
        line.setAttribute('d', d);
        const dArea = d + ` L ${margin.left + cw} ${margin.top + ch} L ${margin.left} ${margin.top + ch} Z`;
        area.setAttribute('d', dArea);
        const yTicks = [0,1,2,3,4,5];
        const yGroup = svg.querySelector('#sim-yticks');
        yGroup.innerHTML = yTicks.map(t=>{
          const yPos = margin.top + ch - (t/maxKW)*ch;
          return `<g><line x1="${margin.left-6}" y1="${yPos}" x2="${margin.left}" y2="${yPos}" stroke="#94a3b8"/><text x="${margin.left-10}" y="${yPos+4}" text-anchor="end" font-size="11" fill="#334155">${t}</text></g>`;
        }).join('');
        const xGroup = svg.querySelector('#sim-xticks');
        const hours = [0,6,12,18,23];
        xGroup.innerHTML = hours.map(h=>{
          const x = margin.left + (h/23)*cw;
          return `<g><line x1="${x}" y1="${margin.top+ch}" x2="${x}" y2="${margin.top+ch+6}" stroke="#94a3b8"/><text x="${x}" y="${margin.top+ch+20}" text-anchor="middle" font-size="11" fill="#334155">${h}h</text></g>`;
        }).join('');
      }
      function gen(){
        const arr=[]; const peak=4.1+Math.random()*0.7;
        for(let h=0; h<24; h++){
          const base = Math.max(0, Math.sin(Math.PI*(h-6)/12));
          const noise = (Math.random()-0.5)*0.3;
          arr.push(Math.max(0, base*peak*(0.9+noise)));
        }
        return arr;
      }
      render(gen());
      const btn = document.getElementById('sim-rerun');
      if(btn){ btn.onclick = ()=> render(gen()); }
    })();

    // ========== SIMULADOR AHORRO ==========
    const billInput  = document.getElementById('bill-input');
    const profileSel = document.getElementById('profile-select');
    const simCalcBtn = document.getElementById('sim-calc');
    const simAhorro  = document.getElementById('sim-ahorro');
    const simAhorroSub = document.getElementById('sim-ahorro-sub');
    const simExtra   = document.getElementById('sim-extra');
    const heroKpiVal = document.getElementById('hero-kpi-value');
    const heroKpiSub = document.getElementById('hero-kpi-sub');

    function formatMoney(v){
      return '$' + v.toLocaleString('en-US',{maximumFractionDigits:0});
    }

    // Estimamos un % de ahorro t√≠pico seg√∫n el monto
    function estimatePct(bill){
      if (bill <= 40) return 25;
      if (bill <= 80) return 35;
      if (bill <= 120) return 40;
      return 45;
    }

    function recalc(){
      const bill = Math.max(0, Number(billInput.value) || 0);
      const pct  = estimatePct(bill);
      const ahorro = bill * pct / 100;
      const anual = ahorro * 12;

      simAhorro.textContent = formatMoney(ahorro);
      simAhorroSub.innerHTML =
        `Basado en una factura de <strong>$${bill}</strong> y un ahorro estimado del <strong>${pct}%</strong>.`;
      simExtra.innerHTML =
        `En un a√±o podr√≠as ahorrar aproximadamente <strong>${formatMoney(anual)}</strong>. ` +
        `Para un perfil <strong>${profileSel.options[profileSel.selectedIndex].text}</strong>, ` +
        `podr√≠amos empezar con un sistema modular y ampliarlo con el tiempo.`;

      // Actualizar KPI del hero para que se vea coherente
      heroKpiVal.textContent = formatMoney(ahorro);
      heroKpiSub.innerHTML =
        `Basado en factura de <strong>$${bill}</strong> y <strong>${pct}%</strong> de ahorro estimado.`;
    }

    simCalcBtn.addEventListener('click', recalc);
    recalc(); // c√°lculo inicial

    // ========== MODAL COTIZACI√ìN ==========
    const quoteBackdrop = document.getElementById('quote-backdrop');
    const quoteClose    = document.getElementById('quote-modal-close');
    const quoteCancel   = document.getElementById('quote-cancel');
    const quoteSend     = document.getElementById('quote-send');
    const quotePlanLbl  = document.getElementById('quote-plan-label');
    const quoteButtons  = document.querySelectorAll('.quote-btn');
    const headerCta     = document.getElementById('cta-header');

    const qName  = document.getElementById('q-name');
    const qPhone = document.getElementById('q-phone');
    const qEmail = document.getElementById('q-email');
    const qCity  = document.getElementById('q-city');
    const qBill  = document.getElementById('q-bill');

    function openQuote(plan){
      if(plan){ quotePlanLbl.textContent = `Plan seleccionado: ${plan}`; }
      else { quotePlanLbl.textContent = 'Plan seleccionado: por definir'; }
      quoteBackdrop.style.display='flex';
    }
    function closeQuote(){
      quoteBackdrop.style.display='none';
    }

    quoteButtons.forEach(btn=>{
      btn.addEventListener('click',()=>openQuote(btn.dataset.plan));
    });
    headerCta.addEventListener('click',()=>openQuote(null));
    quoteClose.addEventListener('click',closeQuote);
    quoteCancel.addEventListener('click',closeQuote);
    quoteBackdrop.addEventListener('click',(e)=>{ if(e.target===quoteBackdrop) closeQuote(); });

    quoteSend.addEventListener('click',()=>{
      const name  = qName.value.trim();
      if(!name){
        alert('Por favor escribe tu nombre para registrar la cotizaci√≥n.');
        qName.focus();
        return;
      }
      const phone = qPhone.value.trim();
      const email = qEmail.value.trim();
      const city  = qCity.value.trim();
      const bill  = qBill.value.trim();
      const plan  = quotePlanLbl.textContent.replace('Plan seleccionado: ','') || 'Sin plan';

      const lead = {
        name,
        phone,
        email,
        city,
        bill,
        plan,
        date: new Date().toISOString()
      };
      leads.push(lead);
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(leads));
      }catch(e){
        console.warn('No se pudo guardar en localStorage', e);
      }
      renderLeads();

      alert('Listo üôå Tu cotizaci√≥n se registr√≥. En una versi√≥n real, se enviar√≠a al equipo de TiriSolar.');
      // limpiar un poco pero dejar nombre por si quiere corregir algo
      qPhone.value = '';
      qEmail.value = '';
      qBill.value  = '';
      closeQuote();
    });
  </script>
</body>
</html>

